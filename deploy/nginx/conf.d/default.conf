server {
	listen 80;
	server_name _;

	# Proxy API requests to local API service
	location /api/ {
		proxy_pass http://volteryde-api:3000/;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-Proto $scheme;
		proxy_http_version 1.1;
		proxy_set_header Connection "";
	}

	# Proxy auth/client API to auth service
	location /auth/ {
		proxy_pass http://client-auth-service:8082/;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-Proto $scheme;
		proxy_http_version 1.1;
		proxy_set_header Connection "";
	}

	# Fallback: return 502 for other upstreams to make errors visible
	location / {
		return 502 "No upstream configured for this path. Use /api/ or /auth/.";
	}
}

